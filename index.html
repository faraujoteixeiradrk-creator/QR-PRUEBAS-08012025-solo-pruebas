<!DOCTYPE html>
<html>
<head>
    <title>Test Modal</title>
</head>
<body>
    <button onclick="abrirEmailMejora()" style="padding:20px; background:orange; color:white; border:none; border-radius:10px; font-size:18px; cursor:pointer;">
        SOLICITAR MEJORA A DRK
    </button>

    <div id="modalClienteDatos" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:99999; justify-content:center; align-items:center;">
        <div style="background:white; padding:30px; border-radius:15px; max-width:450px; width:90%;">
            <h2 style="color:#ea580c;">ğŸ“§ Solicitar Mejora a DRK</h2>
            <input type="text" id="clienteNombre" placeholder="Nombre" style="width:100%; padding:12px; margin-bottom:12px; border:1px solid #ccc; border-radius:8px; box-sizing:border-box;">
            <input type="text" id="clienteApellidos" placeholder="Apellidos" style="width:100%; padding:12px; margin-bottom:12px; border:1px solid #ccc; border-radius:8px; box-sizing:border-box;">
            <input type="email" id="clienteEmail" placeholder="Email" style="width:100%; padding:12px; margin-bottom:12px; border:1px solid #ccc; border-radius:8px; box-sizing:border-box;">
            <input type="tel" id="clienteTelefono" placeholder="TelÃ©fono" style="width:100%; padding:12px; margin-bottom:12px; border:1px solid #ccc; border-radius:8px; box-sizing:border-box;">
            <textarea id="clienteObservaciones" placeholder="Observaciones" rows="3" style="width:100%; padding:12px; margin-bottom:20px; border:1px solid #ccc; border-radius:8px; resize:none; box-sizing:border-box;"></textarea>
            <button onclick="cerrarModalCliente()" style="width:48%; padding:12px; background:#ccc; border:none; border-radius:8px; cursor:pointer; margin-right:4%;">Cancelar</button>
            <button onclick="enviarEmailConDatosCliente()" style="width:48%; padding:12px; background:orange; color:white; border:none; border-radius:8px; cursor:pointer;">ğŸ“§ Enviar</button>
        </div>
    </div>

    <script>
        var lastComparisonResult = {
            cups: "ES0021000021548435PP0F",
            tariffType: "2.0TD",
            originalBillAnnual: 1525.59,
            totalAnnual: 2070.34
        };

        function abrirEmailMejora() {
            console.log('Abriendo modal');
            if (!lastComparisonResult) {
                alert("No hay datos");
                return;
            }
            document.getElementById('modalClienteDatos').style.display = 'flex';
        }

        function cerrarModalCliente() {
            document.getElementById('modalClienteDatos').style.display = 'none';
            document.getElementById('clienteNombre').value = '';
            document.getElementById('clienteApellidos').value = '';
            document.getElementById('clienteEmail').value = '';
            document.getElementById('clienteTelefono').value = '';
            document.getElementById('clienteObservaciones').value = '';
        }

        function enviarEmailConDatosCliente() {
            var nombre = document.getElementById('clienteNombre').value.trim();
            var apellidos = document.getElementById('clienteApellidos').value.trim();
            var email = document.getElementById('clienteEmail').value.trim();
            var telefono = document.getElementById('clienteTelefono').value.trim();
            var obs = document.getElementById('clienteObservaciones').value.trim();
            
            var body = 'Â¡Hola equipo de DRK!\n\nHe realizado una comparaciÃ³n y NO se ha detectado ahorro.\n\n';
            
            if (nombre || apellidos || email || telefono) {
                body += 'ğŸ‘¤ DATOS DEL CLIENTE:\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
                if (nombre) body += 'Nombre: ' + nombre + '\n';
                if (apellidos) body += 'Apellidos: ' + apellidos + '\n';
                if (email) body += 'Email: ' + email + '\n';
                if (telefono) body += 'TelÃ©fono: ' + telefono + '\n';
                body += '\n';
            }
            
            body += 'ğŸ“‹ DATOS DE LA COMPARACIÃ“N:\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
            body += 'CUPS: ' + lastComparisonResult.cups + '\n';
            body += 'Tarifa: ' + lastComparisonResult.tariffType + '\n';
            body += 'Coste actual anual: ' + lastComparisonResult.originalBillAnnual.toFixed(2) + ' â‚¬\n';
            body += 'Coste DRK anual: ' + lastComparisonResult.totalAnnual.toFixed(2) + ' â‚¬\n';
            body += '\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
            
            if (obs) {
                body += '\nğŸ“ OBSERVACIONES:\n' + obs + '\n\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n';
            }
            
            body += '\nâš ï¸ Por favor, revisen este caso y busquen una mejor oferta.\n\nğŸ“ IMPORTANTE: Adjuntar la factura del cliente en el email.\n\nGracias,\nEquipo Comercial';
            
            var mailto = 'mailto:F.araujo@drk.es,rguerra@drk.es,l.grande@drk.es?subject=' + encodeURIComponent('ğŸš¨ SOLICITUD DE MEJORA - Sin ahorro detectado') + '&body=' + encodeURIComponent(body);
            
            cerrarModalCliente();
            window.location.href = mailto;
        }
    </script>
</body>
</html>
